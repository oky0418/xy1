require 'telegram/bot'
require './commands/balance'
require './commands/transfer'
require './commands/deposit'
require './commands/withdraw'
require './commands/red_packet'
require './commands/leaderboard'
require './commands/minesweeper'
require './commands/admin'

# 读取 Telegram 机器人 API Token
token = 'YOUR_BOT_API_TOKEN'  # 替换成你的 API Token

# 运行机器人
Telegram::Bot::Client.run(token) do |bot|
  bot.listen do |message|
    case message.text
    when '/start'
      bot.api.send_message(chat_id: message.chat.id, text: "欢迎来到机器人！\n请输入相关命令来进行操作：\n/id - 查看用户ID\n/balance - 查看余额\n/transfer - 转账\n/deposit - 存款\n/withdraw - 提款\n/red_packet - 发红包\n/leaderboard - 玩家排行榜\n/minesweeper - 扫雷游戏\n/admin - 管理员操作")
    
    when '/id'
      # 查看用户ID
      bot.api.send_message(chat_id: message.chat.id, text: "你的用户ID是: #{message.from.id}")
    
    when '/balance'
      # 查看余额
      BalanceCommand.new(bot, message).execute
    
    when '/transfer'
      # 转账
      TransferCommand.new(bot, message).execute
    
    when '/deposit'
      # 存款
      DepositCommand.new(bot, message).execute
    
    when '/withdraw'
      # 提款
      WithdrawCommand.new(bot, message).execute
    
    when '/red_packet'
      # 发红包
      RedPacketCommand.new(bot, message).execute
    
    when '/leaderboard'
      # 玩家排行榜
      LeaderboardCommand.new(bot, message).execute
    
    when '/minesweeper'
      # 扫雷游戏
      MinesweeperCommand.new(bot, message).execute
    
    when '/admin'
      # 管理员功能
      AdminCommand.new(bot, message).execute
    
    else
      # 处理未知命令
      bot.api.send_message(chat_id: message.chat.id, text: "未知的命令，请尝试使用以下命令：/id, /balance, /transfer, /deposit, /withdraw, /red_packet, /leaderboard, /minesweeper, /admin")
    end
  end
end